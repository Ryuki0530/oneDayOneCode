# Screw Out Puzzle (PyGame) — 今日のPython課題

画像みたいな「ネジを外すとパーツが落ちる」系のミニゲームを、**PyGame**で作ってください。  
（物理はガチにしなくてOK。ルールを割り切って“それっぽい”挙動にするのが狙い）

---

## 目的
- ネジ（スクリュー）をクリックして外す
- 支えを失った板（プレート）が重力で落ちる
- 最終的に**全部のプレートを画面外へ落としたらクリア**

---

## 仕様（必須）

### 画面
- ウィンドウサイズ：`600 x 700`
- 盤面：中央にボードっぽい背景（単色でOK）
- UI：上部に `Removed: X`（外したネジ数） と `R: reset / U: undo` を表示

### オブジェクト
#### 1) Screw（ネジ）
- 位置 `x, y` と `id` を持つ
- 描画は円＋十字（画像を使わず図形でOK）
- 状態：`installed=True/False`

#### 2) Plate（プレート）
- 長方形（色付き）で表現
- `rect`（位置・サイズ）を持つ
- **穴（hole）を2つ以上**持つ（穴の座標はプレートローカル座標で持つ）
- `layer`（重なり順）を持つ（数字が大きいほど上に描画される）

---

## ルール（ゲーム性の核）

### A. ネジが外せる条件（ブロック判定）
クリックしたネジが **「上のプレートに隠されている」**場合、そのネジは外せない。

- ネジ座標 `(sx, sy)` が
- クリック対象のネジより **上の layer** のプレートの `rect` 内にあり
- そのプレートが「まだ落下して画面外に消えていない」
- なら **ブロックされている** とみなす

→ ブロックされていないネジだけ外せる。

### B. プレートの支持判定（支えがあるか）
プレートは「穴の位置にネジが刺さっている」ことで支えられる。

- プレートの hole 座標（ローカル）をワールド座標に変換し
- そこに十分近い（例：距離 <= 10px） installed なネジがあるなら、その hole は支持されている
- **支持 hole が1つ以上あればプレートは落ちない**
- **支持 hole が0なら落下開始**

### C. 落下（簡易物理）
- 支持を失ったプレートは毎フレーム `vy += g`、`y += vy` で落ちる（`g=0.5` くらい）
- 衝突判定は簡易でOK：
  - 画面下端に当たったらそのまま落ち続けて「画面外に消えた」扱いにしても良い
  - 余裕があれば「他のプレートの上に乗る」も実装（発展）

### D. クリア条件
- 全プレートが `screen_y > 720` などで「画面外」に消えたらクリア表示（`CLEAR!`）

---

## レベルデータ（必須）
レベルはコード内に **データとして定義**してください（外部ファイル不要）。

例（この形式にこだわらなくてOK、ただし“データ駆動”にする）：
- `screws = [{id, x, y}, ...]`
- `plates = [{id, rect(x,y,w,h), holes:[(hx,hy),...], layer, color}, ...]`

最低でも：
- ネジ：8個以上
- プレート：5枚以上
- layer で重なりが発生する構成（「隠れて外せないネジ」が存在する）

---

## 操作
- 左クリック：ネジを外す（外せる場合）
- `R`：リセット（初期状態に戻す）
- `U`：1手戻す（Undo）
  - 「ネジを外す」「落下状態の開始」まで含めて戻せるのが理想
  - 最低限、ネジのinstalled状態が戻ればOK

---

## 実装のヒント（設計）
おすすめの更新順：
1. 入力処理（クリック→外せるか判定→外す）
2. 各プレートの「支持」再計算（穴にネジがあるか）
3. 落下中プレートの物理更新（vy, y）
4. 画面外判定（消滅）
5. 描画（layer順にプレート→ネジ→UI）

データ構造のコツ：
- `Plate` は `rect` と `holes_local` を持ち、ワールド穴座標は `rect.topleft + hole_local`
- 「外せるか」判定は、ネジ点が `plate.rect.collidepoint(sx,sy)` でOK

---

## PyGameで必要になりがちな機能（使い方メモ）

### 1) ウィンドウとメインループ
- `pygame.display.set_mode((W,H))`
- `clock = pygame.time.Clock()`
- ループ内で `clock.tick(60)` して60FPS固定

### 2) 入力（マウス）
- `for event in pygame.event.get():`
- `MOUSEBUTTONDOWN` で `event.pos` を取得
- ネジの当たり判定は「距離」または `Rect` で実装
  - 距離なら `(mx-sx)^2 + (my-sy)^2 <= r^2`

### 3) 図形描画
- `pygame.draw.rect(screen, color, rect, border_radius=...)`
- `pygame.draw.circle(screen, color, (x,y), r)`
- 十字は `pygame.draw.line`

### 4) 文字表示
- `font = pygame.font.SysFont(None, 28)`
- `surf = font.render("Removed: 3", True, (255,255,255))`
- `screen.blit(surf, (10,10))`

---

## クリアできたら発展（任意）
- プレート同士の「積み重なり」（落ちて途中で止まる）
- ネジに「回すアニメ」（2～3フレームでも雰囲気出る）
- レベル選択（複数データ）
- サウンド（外す音/落ちる音）
- 最短手数のスコア化

---

## 提出物（あなた用チェック）
- `main.py` だけで起動できる
- 60FPSで動く
- ネジの「外せる/外せない」が分かる（ブロック判定が効いてる）
- 支持を失うとプレートが落ちる
- 全部落とすとクリア

