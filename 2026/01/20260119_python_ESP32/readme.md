# 今日のPython課題（MicroPython / ESP32）: 「LANリモコン・サーボ + OLEDダッシュボード」

## 概要
ESP32（MicroPython）を家庭/研究室の**ローカルネットワーク（Wi-Fi）**に接続し、**スマホのブラウザ**から操作できるミニWebアプリを作成してください。

ESP32には以下が接続されているものとします：
- **SSD1306系OLED（I2C）**（あなたの「LCD1306」はこの系統想定）
- **PWM制御のサーボモーター**

スマホから操作すると、ESP32が
- サーボ角度を変更し
- OLEDに現在状態（角度・IP・最終操作時刻など）を表示し
- ブラウザに現在状態を返す

…という“物理UI付きWebサービス”にします。

---

## 要件

### 1. Wi-Fi接続
- ESP32をSSID/パスワードでWi-Fiに接続し、DHCPでIPを取得すること。
- OLEDに以下を表示すること：
  - `IP: xxx.xxx.xxx.xxx`
  - `SSID: <ssid>`
  - `Angle: <0..180>`

### 2. HTTPサーバ（ESP32単体）
ESP32上でHTTPサーバを起動し、スマホからアクセスできること。

#### エンドポイント仕様
- `GET /`
  - 操作用の簡易Webページ（HTML）を返す
  - ページ内で角度変更できるUIを提供する（例：スライダー、ボタン、入力欄など）
- `POST /api/angle`
  - Body（フォーム or JSON）で `angle`（0〜180）を受け取る
  - サーボ角度を更新する
  - OLED表示も更新する
  - レスポンスはJSON推奨：`{"ok": true, "angle": 120}`
- `GET /api/status`
  - 現在の状態をJSONで返す（最低限：angle, ip, uptime_sec）
  - 例：`{"angle": 90, "ip": "192.168.0.10", "uptime_sec": 123}`

> 注意：インターネット公開は不要。LAN内から叩ければOK。

### 3. サーボ制御
- PWM 50Hz を想定（一般的なホビーサーボ）
- 角度 0〜180 を受け取り、パルス幅に変換して出力すること
- 角度範囲外の入力は**丸める**（例：-10→0、200→180）

### 4. OLED表示（SSD1306）
OLEDには最低限、常時以下を表示：
- IPアドレス
- 現在角度
- 最後に操作された時刻 or 経過秒（どちらでもOK）

---

## 仕様上の制約
- 言語：**MicroPython**
- ESP32単体で完結（PC常駐プロセスなし）
- 外部ライブラリは基本なし（ただしSSD1306ドライバを同梱するのはOK）
- 例外処理を入れて「落ちにくい」こと
  - Wi-Fi接続失敗時のリトライ
  - 不正リクエスト（angle欠落など）のエラー応答（400など）

---

## 成果物
以下のファイル一式（例）を提出できる形にしてください：
- `main.py`（起動エントリ）
- `servo.py`（サーボ制御）
- `ssd1306_simple.py`（OLEDドライバ）
- `web.py`（HTTP処理を分けるなら）
- `README.md`（配線と使い方：SSID設定、アクセス方法、API叩き方）

---

## 動作確認（合格条件）
スマホで同じWi-Fiに接続し、ブラウザでESP32のIPにアクセスして：
1. `GET /` が開き、UIが表示される
2. UI操作で角度を変えるとサーボが動く
3. OLEDのAngle表示が追従する
4. `GET /api/status` が状態JSONを返す

---

## 追加課題（任意・面白さ枠）
- A: `/api/angle` を連打しても固まらない（リクエスト処理を軽く）
- B: 角度変更のたびにOLEDに小さなバー表示（進捗バー風）
- C: スマホページを**自動更新**（JSで `/api/status` をポーリングして表示更新）
- D: 「プリセット」ボタン（0°, 90°, 180°）を用意
- E: mDNS（`http://esp32.local/` みたいに名前で開ける）※できたら強い

---

## ヒント
- 最初は「固定HTML + フォームPOST」で十分。JSは後からでOK。
- OLEDが映らないときはまずI2Cスキャンでアドレス確認（0x3C/0x3Dが多い）
- サーボが震える/ESP32が落ちる場合は、サーボ電源を外部5VにしてGND共通

---

## 期待する学び
- MicroPythonでのWi-Fi接続とHTTPサーバ実装
- GPIO/PWMの扱い（物理出力）
- I2C/OLEDの状態表示（物理デバッグUI）
- 「Webで物理デバイスを操作する」基本構成
