# Python課題: レート制限シミュレーター（トークンバケット, per-IP）

## 概要
Webサーバのアクセスログを読み取り、「各IPアドレスごと」に**トークンバケット方式**のレート制限を適用して、各リクエストが許可（ALLOW）か拒否（BLOCK）かを判定せよ。

- **トークンバケット**  
  - バケット容量 `B`。  
  - 1秒あたり `R` トークン補充（小数可）。  
  - バケット内トークンは上限 `B` を超えない。  
  - リクエスト1件あたり **1トークン** 消費。  
  - トークンが1未満ならそのリクエストは **BLOCK**（消費なし）。  
  - 判定は **IPごとに独立**（各IPに専用のバケットがある）。

## 入力
標準入力から以下の形式で与えられる。

```
R B
N
t1 ip1 path1
t2 ip2 path2
...
tN ipN pathN
```

- `R`：1秒あたりの補充速度（実数, 0 ≤ R ≤ 1000）  
- `B`：バケット容量（実数, 0 ≤ B ≤ 10^6）  
- `N`：ログ行数（整数, 0 ≤ N ≤ 2×10^5）  
- 各行：  
  - `t`：UNIX秒（整数, 0 ≤ t ≤ 10^12）。**非減少**（同時刻複数可）  
  - `ip`：IPv4風の文字列（例: `192.168.0.1`）  
  - `path`：スペースを含まないパス（例: `/api/v1/items`）

### 初期状態
- あるIPが**初めて**登場したとき、そのIPのトークン量は **`B`（満タン）** とする。  
- 以後、そのIPで新しい行が来るたびに、直前に処理した時刻からの経過秒数に `R` を掛けて補充し、`min(B, 現在量 + 経過秒×R)` としてから判定する。

## 出力
各入力行に対して、次の形式で1行ずつ出力せよ。

```
t ip path RESULT
```

- `RESULT` は `ALLOW` または `BLOCK`。

## 処理規則（厳密仕様）
- **補充のタイミング**：各リクエスト行を処理する直前に、同一IPのバケットへ経過時間分のトークンを補充する。  
- **同時刻の複数行**：同一時刻 `t` の複数行がある場合、行の入力順で処理する（同一IPなら後続行は前行の消費の影響を受ける）。  
- **実数トークン**：内部では実数で扱い、判定は「現在トークン量が **1以上** なら許可・1消費、1未満なら拒否・消費なし」。

## 制約と実装メモ
- IPごとに以下を連想配列で保持すると良い：  
  - `last_t`（最後に処理した時刻）  
  - `tokens`（現在のトークン量, 実数）  
- 補充式：`tokens = min(B, tokens + (t - last_t) * R)`（初回は `last_t = t` として補充0でもよい）  
- 標準ライブラリのみ使用（外部パッケージ禁止）。  
- 入出力高速化（`sys.stdin.readline`, `sys.stdout.write` 等）を推奨。  
- 浮動小数の誤差による境界判定は、必要に応じて小さなイプシロンを用いてもよい。

## 入出力例

### 例1
**入力**
```
5 10
5
0 10.0.0.1 /ping
0 10.0.0.1 /ping
1 10.0.0.1 /ping
2 10.0.0.2 /login
2 10.0.0.1 /ping
```

**出力（例）**
```
0 10.0.0.1 /ping ALLOW
0 10.0.0.1 /ping ALLOW
1 10.0.0.1 /ping ALLOW
2 10.0.0.2 /login ALLOW
2 10.0.0.1 /ping ALLOW
```

### 例2（BLOCKが出るケース）
**入力**
```
1 2
5
10 1.1.1.1 /a
10 1.1.1.1 /b
10 1.1.1.1 /c
11 1.1.1.1 /d
12 1.1.1.1 /e
```

**出力（例）**
```
10 1.1.1.1 /a ALLOW
10 1.1.1.1 /b ALLOW
10 1.1.1.1 /c BLOCK
11 1.1.1.1 /d ALLOW
12 1.1.1.1 /e ALLOW
```

### 例3（IPごとに独立）
**入力**
```
0.5 1.0
5
0 9.9.9.9 /x
0 8.8.8.8 /y
0 9.9.9.9 /z
1 9.9.9.9 /x
2 8.8.8.8 /y
```

**出力（例）**
```
0 9.9.9.9 /x ALLOW
0 8.8.8.8 /y ALLOW
0 9.9.9.9 /z BLOCK
1 9.9.9.9 /x ALLOW
2 8.8.8.8 /y ALLOW
```

## 追加課題（任意）
- **秒ごとの統計**：各秒の `ALLOW`/`BLOCK` 件数を標準エラー出力へログ。  
- **パス重み**：`/login` は2トークン消費など、エンドポイント別のコストに対応。  
- **初期量変更**：各IPの初期トークン量を `α·B (0≤α≤1)` で開始できるようにする。
