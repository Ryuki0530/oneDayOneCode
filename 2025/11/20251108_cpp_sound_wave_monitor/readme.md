C++ 課題: リアルタイム音声「ミニ・オシロスコープ」（SFML）
概要

PCのマイク入力またはWAVファイルをソースに、リアルタイム波形と**音量メーター（RMS）**を描画する小さなオシロスコープを作成せよ。入出力（CLI引数・ファイル読み込み・描画・保存）を一通り組み合わせ、リアルタイム処理の基礎を体験すること。

必須要件

入力ソース

既定：マイク入力を使用（OSでマイク権限が許可されている前提）。

代替：--input <path.wav> 指定時は WAV（16bit PCM, mono/stereo） をループ供給して可視化する。stereo の場合は L チャンネルのみで良い。

描画ウィンドウ

解像度 1280×720、タイトルは Mini Oscilloscope (SFML)。

波形描画：横軸=時間、縦軸=振幅。新しいサンプルが右端に現れるか、左→右へスクロール表示のいずれかを実装せよ。

RMSメーター：画面左下付近に直近 50ms 程度の RMS を 0.0〜1.0 で棒グラフ表示。

オーバーレイ（テキスト）：入力ソース種別、サンプリングレート、推定遅延（ms）、操作ヘルプを表示。

操作

SPACE：描画の一時停止/再開（取り込みは継続してもよい）。

P：現在のフレームを ./capture_YYYYMMDD_HHMMSS.png で保存。

ESC またはウィンドウ×：終了。

コマンドライン引数

--input <wav>：WAVファイルを入力ソースにする（16bit PCM/mono または stereo 想定）。

--sr <rate>：サンプリングレート（既定 44100）。デバイス非対応時はエラーメッセージを出すか安全な既定値へフォールバック。

--device <name> または --device-index <i>：マイクデバイスを指定可能にする（一覧表示は後述）。

--list-devices：利用可能な録音デバイス名を標準出力に列挙して終了。

--help：使い方を表示して終了。

内部バッファ

表示用にリングバッファ（3秒分以上）を実装し、古いデータは上書きする。

int16 サンプルは [-32768, 32767] -> [-1.0, 1.0] に正規化して扱うこと。

ログ/エラー処理

起動時に入力ソース・サンプリングレート・チャネル数などを標準出力へ表示。

非対応フォーマットのWAVや、録音不可デバイス指定時はわかるメッセージで失敗させる（クラッシュ不可）。

入出力仕様

入力：マイク（任意デバイス）または --input sample.wav（16bit PCM）。

出力：

画面表示（波形＋RMS＋オーバーレイ）。

P キーで PNG スクリーンショット（capture_*.png）。

標準出力ログ（開始/停止、デバイス情報、WAVメタ情報、エラーなど）。

実装制約

ライブラリは SFML（system/window/graphics/audio） を使用すること。

スレッド安全性：録音コールバック（またはWAV供給）からリングバッファへの書き込みは排他制御を行うこと。

RMS 計算は 50ms 窓（サンプル数は sr * 0.05 を目安）で行い、50ms周期程度で更新して良い。

WAV入力時はループ再生で連続表示させること。

ビルド要件（想定環境）

Windows 11 / VSCode / CMake / vcpkg

依存：sfml:x64-windows

C++標準：C++20 以上
